[build]
  command = "pnpm install --frozen-lockfile && pnpm run prisma:generate && pnpm run build"
  publish = ".next"

[build.environment]
  NODE_VERSION = "20"
  NEXT_PRIVATE_SKIP_VALIDATION = "1"
  PNPM_VERSION = "9"
  SECRETS_SCAN_ENABLED = "false"

# Plugin Next.js (necessário)
[[plugins]]
  package = "@netlify/plugin-nextjs"

# NOTA: Headers agora são definidos em public/_headers
# para melhor controle do CSP e evitar conflitos

# Redirects
[[redirects]]
  from = "/health"
  to = "/api/health"
  status = 200

[[redirects]]
  from = "/admin"
  to = "/dashboard"
  status = 301

# Função serverless timeout
[functions]
  node_bundler = "esbuild"
  
[functions."api/*"]
  node_bundler = "esbuild"
